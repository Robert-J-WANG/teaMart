@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = null;

}

<!-- 注入服务，使用HttpContextAccessor 接口 -->
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@inject teaMart.Models.dbContext _dbContext


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-clearmin.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/roboto.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/material-design.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/small-n-flat.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.min.css">
    <title>TeaMart Adimn System</title>
</head>
<body class="cm-no-transition cm-1-navbar">
    
    <!-- 侧边栏区域 -->
    <div id="cm-menu">
        <nav class="cm-navbar cm-navbar-primary">
            <div class="cm-flex"><a href="/index.html" class="cm-logo"></a></div>
            <div class="btn btn-primary md-menu-white" data-toggle="cm-menu"></div>
        </nav>
        <div id="cm-menu-content">
            <div id="cm-menu-items-wrapper">
                <div id="cm-menu-scroller">
                    <ul class="cm-menu-items">
                        <li class="active"><a href="/" class="sf-house">Dashboard</a></li>
                        <li><a href="/User/Index" class="sf-dashboard">Users</a></li>
                        <li><a href="/Admins/Index" class="sf-brick">Admins</a></li>
                        <li class="cm-submenu">
                            <a class="sf-window-layout">ImageChart<span class="caret"></span></a>
                            <ul>
                                <li ><a href="/ImageChart/Create">Add Images</a></li>
                                <li><a href="/ImageChart/Index">More</a></li>
                            </ul>
                        </li>
                        <li class="cm-submenu">
                            <a class="sf-folder">Category <span class="caret"></span></a>
                            <ul>
                                <li><a href="/Category/Create">Add Category</a></li>
                                <li><a href="/Category/Index">More</a></li>
                           
                            </ul>
                        </li>
                        <li><a href="/Article/Index" class="sf-heart">Article</a></li>
                        <li><a href="/Product/Index" class="sf-shop">Product</a></li>
                        <li><a href="/Coupons/Index" class="sf-gift">Coupons</a></li>
                        <li><a href="/Orders/Index" class="sf-bag">Orders</a></li>
                        <li><a href="/OrderComment/Index" class="sf-thumb-up">Comment</a></li>
                        <li><a href="/Product/Index" class="sf-box-full">Customer Service</a></li>
                       
                        <li class="cm-submenu">
                            <a class="sf-monitor">Sales Statistics<span class="caret"></span></a>
                            <ul>
                                <li><a href="/Admin/ShopCount">Product Count</a></li>
                                <li><a href="/Admin/OrderCount">Order Count</a></li>
                            </ul>
                        </li>

                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 头部信息区域 -->
    <header id="cm-header">
        <nav class="cm-navbar cm-navbar-primary">
            <div class="btn btn-primary md-menu-white hidden-md hidden-lg" data-toggle="cm-menu"></div>
            <div class="cm-flex">
                <h1><a href="/" style="color:whitesmoke; text-decoration:none">Admin Dashboard</a></h1>
                <form id="cm-search" action="index.html" method="get">
                    <input type="search" name="q" autocomplete="off" placeholder="Search...">
                </form>
            </div>
            <div class="pull-right">
                <div id="cm-search-btn" class="btn btn-primary md-search-white" data-toggle="cm-search"></div>
            </div>
            <!-- 这里需要获取管理员的消息的条数 需要使用session服务注入-->
            
            @{
                int count = 0;
                var id = HttpContextAccessor.HttpContext.Session.GetInt32("id");
                if (id != null)
                {
                    int uid = id.Value;
                    count = _dbContext.ChatMessages.Where(m => m.ToUserid == uid && m.IsRead == 0).Count();
                }
            }
            
            <div class="dropdown pull-right">
                <button class="btn btn-primary md-notifications-white" data-toggle="dropdown"> <span class="label label-danger">@count</span> </button>
                <div class="popover cm-popover bottom">
                    <div class="arrow"></div>
                    <div class="popover-content">
                        <div class="list-group">
                            <a href="/#" class="list-group-item">
                                <h4 class="list-group-item-heading text-overflow">
                                    <i class="fa fa-fw fa-envelope"></i> Nunc volutpat aliquet magna.
                                </h4>
                                <p class="list-group-item-text text-overflow">Pellentesque tincidunt mollis scelerisque. Praesent vel blandit quam.</p>
                            </a>
                            <a href="/#" class="list-group-item">
                                <h4 class="list-group-item-heading">
                                    <i class="fa fa-fw fa-envelope"></i> Aliquam orci lectus
                                </h4>
                                <p class="list-group-item-text">Donec quis arcu non risus sagittis</p>
                            </a>
                            <a href="/#" class="list-group-item">
                                <h4 class="list-group-item-heading">
                                    <i class="fa fa-fw fa-warning"></i> Holy guacamole !
                                </h4>
                                <p class="list-group-item-text">Best check yo self, you're not looking too good.</p>
                            </a>
                        </div>
                        <div style="padding:10px"><a class="btn btn-success btn-block" href="/#">Show me more...</a></div>
                    </div>
                </div>
            </div>



            <div class="dropdown pull-right">
                <button class="btn btn-primary md-account-circle-white" data-toggle="dropdown"></button>
                <ul class="dropdown-menu">
                    <li class="disabled text-center">
                        <a style="cursor:default;">
                            <strong>
                                @{
                                    // 获取管理员身份信息
                                    var role = HttpContextAccessor.HttpContext.Session.GetInt32("role");
                                    if(role!=null && role == 2)
                                    {
                                        <span class="text-success">(Super Admin)</span>
                                    }
                                    else
                                    {
                                        <span class="text-success">(Admin)</span>
                                    }
                                }
                                @HttpContextAccessor.HttpContext.Session.GetString("nickname")
                        
                            </strong></a>
                    </li>
                    <li class="divider"></li>
                    
                    <li>
                        <a href="/Admin/Update"><i class="fa fa-fw fa-cog"></i> Reset Password</a>
                    </li>
                    <li>
                        <a href="/Login/Logout"><i class="fa fa-fw fa-sign-out"></i> Sign out</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- 主体内容区域 -->
    <div id="global">
        <div class="container-fluid" style="background:#fff;">
            <div class="row cm-fix-height">
                @RenderBody()
            </div>
        </div>
    </div>
    <!-- 主体区域替换结束 -->
    <script src="/assets/js/lib/jquery.min.js"></script>
    <script src="/assets/js/jquery.mousewheel.min.js"></script>
    <script src="/assets/js/jquery.cookie.min.js"></script>
    <script src="/assets/js/fastclick.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/clearmin.min.js"></script>
    <script src="/assets/js/demo/home.js"></script>
</body>
</html>
